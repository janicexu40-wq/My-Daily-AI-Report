name: Daily AI Morning Briefing

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š7ç‚¹è¿è¡Œï¼ˆUTCæ—¶é—´å‰ä¸€å¤©23ç‚¹ï¼‰
    - cron: '0 23 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘æµ‹è¯•
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  #ä»¥æ­¤æƒé™æäº¤ç”Ÿæˆçš„æ–‡ä»¶

    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      # ç›´æ¥è¯»å– requirements.txtï¼Œç¡®ä¿å’Œæœ¬åœ°ç¯å¢ƒä¸€è‡´
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸš€ å¯åŠ¨æ™¨é—´çŒæ‰‹ (ç”Ÿæˆ -> ä¸Šä¼  -> æ¸…ç†)
      env:
        # å¿…é¡»æŠŠæ‰€æœ‰å¯†é’¥éƒ½ä¼ ç»™ main.py
        DASHSCOPE_API_KEY: ${{ secrets.DASHSCOPE_API_KEY }}
        ALIYUN_REFRESH_TOKEN: ${{ secrets.ALIYUN_REFRESH_TOKEN }}
        BARK_KEY: ${{ secrets.BARK_KEY }}
      run: |
        # è¿è¡Œæ ¸å¿ƒè„šæœ¬ï¼Œæ‰€æœ‰çš„é€»è¾‘éƒ½åœ¨è¿™é‡Œé¢å®Œæˆäº†
        python main.py

    - name: ğŸ“¤ åŒæ­¥å˜æ›´åˆ°ä»“åº“
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # å…³é”®ï¼šgit add . ä¼šè‡ªåŠ¨è¯†åˆ« Python è„šæœ¬åˆ é™¤çš„æ–‡ä»¶
        git add .
        
        # åªæœ‰å½“æœ‰æ–‡ä»¶å˜åŠ¨ï¼ˆæœ‰æ–°æ–‡ä»¶æˆ–æœ‰æ–‡ä»¶è¢«åˆ ï¼‰æ—¶æ‰æäº¤
        git diff --quiet && git diff --staged --quiet || git commit -m "ğŸš€ è‡ªåŠ¨æ›´æ–°ï¼šç”Ÿæˆæ–°æƒ…æŠ¥å¹¶æ¸…ç†æ—§æ–‡ä»¶"
        git push
